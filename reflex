#!/usr/bin/env bash
# reflex <surfraw-elvis> [i]    -> i == interactive
# A tiny wrapper for surfraw that searches the highlighted text with chosen web service

set -euo pipefail

command -v surfraw >/dev/null || { echo "surfraw is not installed." >&2; exit 1; }

elvis=${1:?Usage: $0 <surfraw_elvis> [i]}
interactive=${2:-}

if [[ $interactive ]]; then
    query=$(rofi -dmenu -p "$elvis")
else
    # Assumes Wayland. For X11, use `xclip -o`.
    query=$(wl-paste --primary --no-newline)
fi

[[ -z "$query" ]] && exit 0

# Get the URL from surfraw without opening it
url=$(surfraw -print "$elvis" -- "$query")

# Open that URL with a specific browser (e.g., Vivaldi)
vivaldi $url &>/dev/null &
