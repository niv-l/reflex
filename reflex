#!/usr/bin/env bash
# qsearch <service> [i]    -> i == interactive (uppercase binding)
# author: Nivyan Lakhani

set -euo pipefail

service=$1                # w g c m â€¦
interactive=${2-""}       # "i" or ""

# -----------------------------------------------------------------------------
# Build base-URL for every service
# -----------------------------------------------------------------------------

case "$service" in
  w) base='https://en.wikipedia.org/w/index.php?search='             ;;
  g) base='https://www.google.com/search?q='                         ;;
  s) base='https://scholar.google.com/scholar?hl=en&as_sdt=0%2C5&q=' ;;
  c) base='https://github.com/search?q='                             ;;
  m) base='https://www.wolframalpha.com/input/?i='                   ;;
  *) echo "unknown service"; exit 1                                  ;;
esac

urlencode() { jq -s -R -r @uri; }   # quick URL encoder via jq

# -----------------------------------------------------------------------------
# Get the query
# -----------------------------------------------------------------------------
#
if [[ $interactive ]]; then
    query=$(
        rofi -show qsearch \
             -modi "qsearch:~/.local/bin/qsearch_complete ${service}"
    )
else
    # I use wayland, replace this with your environment's equivalent .
    query=$(wl-paste --primary --no-newline | tr -d '\n')
fi

[[ -z $query ]] && exit 0

# uses xdg-open. replace it to specify a browser
xdg-open "${base}$(printf '%s' "$query" | urlencode)" >/dev/null 2>&1 &
